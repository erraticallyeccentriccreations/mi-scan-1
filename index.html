<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filament Scanner</title>

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<style>
body {
    background: #000;
    color: #fff;
    font-family: sans-serif;
    text-align: center;
    margin: 0;
    padding: 10px;
}

#scanner-container {
    margin-top: -80px;
}

#reader {
    width: 100%;
    min-height: 250px;
    margin-top: -60px;
    border: 2px solid #333;
}

#status {
    margin-top: 15px;
    font-size: 1.3rem;
    min-height: 40px;
}

.success { color: #0f0; }
.idle { color: #888; }

button {
    width: 90%;
    max-width: 320px;
    padding: 16px;
    font-size: 1.1rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
}

#start-btn {
    background: #007bff;
    color: white;
    margin-top: 20vh;
}

#clear-btn {
    background: #dc3545;
    color: white;
    margin-top: 12px;
}

#view-btn {
    background: #28a745;
    color: white;
    margin-top: 12px;
}
</style>
</head>

<body>

<button id="start-btn" onclick="startScanner()">âš¡ Start Scanner</button>
<button id="clear-btn" onclick="clearInventory()">ðŸ§¹ Clear Inventory</button>
<button id="view-btn" onclick="viewInventory()">ðŸ“‹ View Inventory</button>

<div id="scanner-container" style="display:none;">
    <div id="reader"></div>
    <div id="status" class="idle">Loading productsâ€¦</div>
</div>

<script>
/* =============================
   CONFIG
============================= */

const SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbySceeS-1b8bQ-RQXICYU-flzVlvCwSSBLXI-7Tyq1ct60QN1AcnvXqEPaig4xWo6cC/exec";

const INVENTORY_URL =
  "https://docs.google.com/spreadsheets/d/1JGgkmJw-ZomVjKmLauKJ8V070_Vhx-97WvdhHLCJrmc/edit#gid=0";

/* CSV export of Products sheet */
const PRODUCTS_CSV_URL =
  "https://docs.google.com/spreadsheets/d/1JGgkmJw-ZomVjKmLauKJ8V070_Vhx-97WvdhHLCJrmc/export?format=csv&gid=0";

/* =============================
   PRODUCT CACHE
============================= */

const productMap = {}; // barcode -> color

fetch(PRODUCTS_CSV_URL)
    .then(r => r.text())
    .then(csv => {
        const lines = csv.split("\n").slice(1);
        lines.forEach(line => {
            const cols = line.split(",");
            const barc
